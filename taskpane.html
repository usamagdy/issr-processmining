<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>My Task Pane</title>
  <!-- Load office.js and xlwings.min.js -->
  <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
  <!-- Bootstrap with the xlwings theme -->
  
  <!-- Load Custom Functions -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

 <style>
   
/* CSS */
.button-21 {
  align-items: center;
  appearance: none;
  background-color: #3EB2FD;
  background-image: linear-gradient(1deg, #4F58FD, #149BF3 99%);
  background-size: calc(100% + 20px) calc(100% + 20px);
  border-radius: 100px;
  border-width: 0;
  box-shadow: none;
  box-sizing: border-box;
  color: #FFFFFF;
  cursor: pointer;
  display: inline-flex;
  font-family: CircularStd,sans-serif;
  font-size: 15px;
  height: auto;
  justify-content: center;
  line-height: 1.5;
  padding: 6px 20px;
  position: relative;
  text-align: center;
  text-decoration: none;
  transition: background-color .2s,background-position .2s;
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
  vertical-align: top;
  white-space: nowrap;
}

.button-21:active,
.button-21:focus {
  outline: none;
}

.button-21:hover {
  background-position: -20px -20px;
}

.button-21:focus:not(:active) {
  box-shadow: rgba(40, 170, 255, 0.25) 0 0 0 .125em;
}
   
.button {
  display: inline-block;
  padding: 4px 10px;
  font-size: 15px;
  cursor: pointer;
  text-align: center;
  text-decoration: none;
  outline: none;
  color: #fff;
  background-color: #80c9e8;
  border: none;
  border-radius: 4px;
  box-shadow: 0 1px #999;
}

.button:hover {background-color: #80c9e8}

.button:active {
  background-color: #80c9e8;
  box-shadow: 0 2px #666;
  transform: translateY(4px);
}
   
/* CSS */
.button-63 {
  align-items: center;
  background-image: linear-gradient(144deg,#AF40FF, #5B42F3 50%,#00DDEB);
  border: 0;
  border-radius: 8px;
  box-shadow: rgba(151, 65, 252, 0.2) 0 15px 30px -5px;
  box-sizing: border-box;
  color: #FFFFFF;
  display: flex;
  font-family: Phantomsans, sans-serif;
  font-size: 20px;
  justify-content: center;
  line-height: 1em;
  max-width: 100%;
  min-width: 140px;
  padding: 19px 24px;
  text-decoration: none;
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
  white-space: nowrap;
  cursor: pointer;
}

.button-63:active,
.button-63:hover {
  outline: 0;
}

@media (min-width: 768px) {
  .button-63 {
    font-size: 24px;
    min-width: 196px;
  }
}
</style>
</head>

<body style="background-color:#2f71c0;">
    <!-- Put a button on the task pane -->
     <p style="color:white">01:215!</p>
<table style="width:100%" >
 <tr class="center">
  <img src="https://usamagdy.github.io/issr-processmining/issrLogo.png" alt="ISSR" style="width:120px; height:80px;float:right;">

     <p style="color:white">كلية الدراسات العليا للبحوث الاحصائية</p>
</tr>
</table>
<div class="container">
  <h2 style="color:white" >Samples</h2>
  <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#demoa">Samples</button>
  <div id="demoa" class="collapse">

    
  <table style="width:100%" >
  <tr class="center">

</br>
  </br>
  
     </tr>
 <tr class="center">

  
  <p style="color:white">Hit the button to Say Hello
  </p>
    <button id="run-btnaHello" type="button" class="button-21">Hello</button>

  </tr>

     <tr class="center">

  
  <p style="color:white">yosri- Random
  </p>
    <button id="run-btnaHelloRanyosri" type="button" class="button-21">yosri-Random</button>

  </tr>
    
 <tr class="center">


  </br>
  </br>
 <p style="color:white">
   
   Hit the  button to get time
 
 </p>
 <button id="run-btnaTime" type="button"  class="button-21">Get Time </button>
</tr>
  
  <tr class="center">

  </br>

  </br>
  <p style="color:white">Hit the button to Run Python</p>
    <button id="run-btnaHpython" type="button" class="button-21">Python</button>

  </tr>
      <tr class="center">

  </br>

  </br>
  <p style="color:white">Hit the button to Run Python With Values</p>
    <button id="run-btnaHpythonValue" type="button" class="button-21">Python With Values</button>

  </tr>
    
   <tr class="center">

    
  </tr>
 
 
  
</table>
 </div>
</div>


  
  <div class="container">
  <h2 style="color:white" >Data Mining</h2>
  <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#demo">Data Mining</button>
  <div id="demo" class="collapse">

<table>
    <tr class="center">

  </br>
</tr>
    <tr class="center">

  
  <p style="color:white">Hit the  button to visualize your data in distplot </p>
    <button id="run-subPlot" type="button" class="button-21" >Dist Plot</button>

  </tr>

  
   <tr class="center">

  
  <p style="color:white">Hit the  button to visualize your data in PairGrid </p>
    <button id="run-PairGrid" type="button" class="button-21"  >Pair Grid</button>

  </tr>

   <tr class="center">

  
  <p style="color:white">Hit the  button to Get Kmeans for your Data </p>
    <button id="run-datamini" type="button" class="button-21"  >Kmeans</button>

  </tr>
  
  
</table>

    
  </div>
</div>

 <div class="container">
  <h2 style="color:white" >security</h2>
  <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#demosecurity">Security </button>
  <div id="demosecurity" class="collapse">

<table>
    <tr class="center">

  </br>
</tr>
    <tr class="center">

  
  <p style="color:white">Hit the  button to check your website virus </p>
    <button id="run-virus" type="button" class="button-21" >URL Check</button>

  </tr>
    <tr class="center">

  
  <p style="color:white">to Encrypt your Values Select key ,cipher</p>
    <button id="run-encrypt" type="button" class="button-21" >Encrypt</button>

  </tr>

    
  
</table>

    
  </div>
</div>
  
    <script>
        // Initialize Office.js
        Office.onReady(function (info) { });

        // Add a click event listener to the button
     
      document.getElementById("run-btnaHpythonValue").addEventListener("click", runwspostpywithValue);  
      document.getElementById("run-btnaHpython").addEventListener("click", runwspostpy);
        document.getElementById("run-btnaTime").addEventListener("click", runwsposttime);
      document.getElementById("run-btnaHello").addEventListener("click", runwsposthello);
      document.getElementById("run-subPlot").addEventListener("click", readImageFromFile);
      
      document.getElementById("run-PairGrid").addEventListener("click", readImageFromFilePairGrid);
            document.getElementById("run-datamini").addEventListener("click", readImageFromFileResult);
      document.getElementById("run-btnaHelloRanyosri").addEventListener("click", runwsposthelloRandomyosri);
      document.getElementById("run-virus").addEventListener("click", runwsvirus);
      document.getElementById("run-encrypt").addEventListener("click", runencrypt);

      

      
       // Based on 'Basic API call' sample from ScriptLab

  async function readImageFromFileResult() {
  const reader = new FileReader();
  const myFile = await getFileFromUrl('https://usamagdy.github.io/issr-processmining/result20.png', 'example.jpg');

  reader.onload = (event) => {
    Excel.run((context) => {
      const startIndex = reader.result.toString().indexOf("base64,");
      const myBase64 = reader.result.toString().substr(startIndex + 7);
      const sheet = context.workbook.worksheets.getItem("DataMining");
      const image = sheet.shapes.addImage(myBase64);
      image.name = "Image";
      return context.sync();
    });
  };

  // Read in the image file as a data URL.
  reader.readAsDataURL(myFile);
  async function getFileFromUrl(url, name, defaultType = 'image/jpeg') {
    const response = await fetch(url);
    const data = await response.blob();
    return new File([data], name, {
      type: data.type || defaultType,
    });
  }
}
      
  async function readImageFromFilePairGrid() {
  const reader = new FileReader();
  const myFile = await getFileFromUrl('https://usamagdy.github.io/issr-processmining/result2.png', 'example.jpg');

  reader.onload = (event) => {
    Excel.run((context) => {
      const startIndex = reader.result.toString().indexOf("base64,");
      const myBase64 = reader.result.toString().substr(startIndex + 7);
      const sheet = context.workbook.worksheets.getItem("DataMining");
      const image = sheet.shapes.addImage(myBase64);
      image.name = "Image";
      return context.sync();
    });
  };

  // Read in the image file as a data URL.
  reader.readAsDataURL(myFile);
  async function getFileFromUrl(url, name, defaultType = 'image/jpeg') {
    const response = await fetch(url);
    const data = await response.blob();
    return new File([data], name, {
      type: data.type || defaultType,
    });
  }
}
  async function readImageFromFile() {
  const reader = new FileReader();
  const myFile = await getFileFromUrl('https://usamagdy.github.io/issr-processmining/result1.png', 'example.jpg');

  reader.onload = (event) => {
    Excel.run((context) => {
      const startIndex = reader.result.toString().indexOf("base64,");
      const myBase64 = reader.result.toString().substr(startIndex + 7);
      const sheet = context.workbook.worksheets.getItem("DataMining");
      const image = sheet.shapes.addImage(myBase64);
      image.name = "Image";
      return context.sync();
    });
  };

  // Read in the image file as a data URL.
  reader.readAsDataURL(myFile);
  async function getFileFromUrl(url, name, defaultType = 'image/jpeg') {
    const response = await fetch(url);
    const data = await response.blob();
    return new File([data], name, {
      type: data.type || defaultType,
    });
  }
}

  async function runwspostpywithValue() {
  await Excel.run(async (context) => {
    let activeCell = context.workbook.getActiveCell();
    activeCell.load("address, values,columnIndex,rowIndex");
    await context.sync();

    console.log("The active cell is " + activeCell.columnIndex + activeCell.rowIndex);
    const sheets = context.workbook.worksheets;
    let cell = sheets.getItem("Sheet1").getCell(activeCell.rowIndex, activeCell.columnIndex);
    cell.load("address, values");
    await context.sync();
    var jsonDate = cell.values[0][0];
    console.error(jsonDate);
    if (jsonDate.indexOf("&") !== -1) {
      console.error("String contains '&'");
      console.error(" jsonDate" + jsonDate)  ;
      
      var jsonTemp = jsonDate.substring(jsonDate.indexOf("&") + 1);
      jsonTemp = jsonTemp.substring(0, jsonTemp.indexOf("&"));
      console.error("jsonTemp    ++++" + jsonTemp);
      let cells = sheets.getItem("Sheet1").getRange(jsonTemp);
      cells.load("address, values");
      await context.sync();

      console.error(cell.address + "   jsonTemp   " + jsonTemp + "   " + cells.values);

      jsonDate = jsonDate.replace(("&" + jsonTemp + "&"), cells.values);

      console.error("---*-- " + jsonDate);

    } else {
      console.error("String does not contain '&'");
    }

    var text = " ";
    await new Promise(function (resolve, reject) {
      const url = "https://cb599b0d5db8.ngrok.app/python";
      var response = "";
      let xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function () {
        if (xhttp.readyState !== 4) return;

        if (xhttp.status == 200) {
          resolve(JSON.parse(xhttp.responseText).watchers_count);
          response = xhttp.responseText;
          text = xhttp.responseText;
          console.error("MAIN " + response);
          return response;

        } else {
          reject({
            status: xhttp.status,

            statusText: xhttp.statusText
          });
        }
      };

      xhttp.open("POST", url, true);
      xhttp.setRequestHeader("ngrok-skip-browser-warning", "1");
      xhttp.setRequestHeader('Content-Type', 'application/json');
      console.error("before va" + jsonDate);
      xhttp.send(JSON.stringify(jsonDate));

    });;

    console.error(text);
    console.error("after call");
    await context.sync();


    sheets.getItem("Sheet1").getCell(activeCell.rowIndex, activeCell.columnIndex + 1).values = [[text]];
    await context.sync();
  });
}

      
async function runwspostpy() {
  await Excel.run(async (context) => {
    let activeCell = context.workbook.getActiveCell();
    activeCell.load("address, values,columnIndex,rowIndex");
    await context.sync();

    console.log("The active cell is " + activeCell.columnIndex + activeCell.rowIndex);
    const sheets = context.workbook.worksheets;
    let cell = sheets.getItem("Sheet1").getCell(activeCell.rowIndex,activeCell.columnIndex );
    cell.load("address, values");
    await context.sync();
    var jsonDate = cell.values[0][0];
    console.error(jsonDate);
    var text = " ";
    await new Promise(function (resolve, reject) {
      const url = "https://cb599b0d5db8.ngrok.app/python";
      var response = "";
      let xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function () {
        if (xhttp.readyState !== 4) return;

        if (xhttp.status == 200) {
          resolve(JSON.parse(xhttp.responseText).watchers_count);
          response = xhttp.responseText;
          text = xhttp.responseText;
          console.error("MAIN " + response);
          return response;

        } else {
          reject({
            status: xhttp.status,

            statusText: xhttp.statusText
          });
        }
      };

      xhttp.open("POST", url, true);
      xhttp.setRequestHeader("ngrok-skip-browser-warning", "1");
      xhttp.setRequestHeader('Content-Type', 'application/json');
      console.error("before va" + jsonDate);
      xhttp.send(JSON.stringify(jsonDate));

    });;

    console.error(text);
    console.error("after call");
    await context.sync();


    sheets.getItem("Sheet1").getCell(activeCell.rowIndex, activeCell.columnIndex+1).values  = [[ text]];
    await context.sync();
  });
}
async function runwsposthelloRandomyosri() {
  await Excel.run(async (context) => {
    let activeCell = context.workbook.getActiveCell();
    activeCell.load("address, values,columnIndex,rowIndex");
    await context.sync();

    console.log("The active cell is " + activeCell.columnIndex + activeCell.rowIndex);
    const sheets = context.workbook.worksheets;
    let cell = sheets.getItem("Sheet1").getCell(activeCell.rowIndex,activeCell.columnIndex );
    cell.load("address, values");
    await context.sync();
    var jsonDate = cell.values[0][0];
    console.error(jsonDate);
    var text = " ";
    await new Promise(function (resolve, reject) {
      const url = "https://cb599b0d5db8.ngrok.app/ran";
      var response = "";
      let xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function () {
        if (xhttp.readyState !== 4) return;

        if (xhttp.status == 200) {
          resolve(JSON.parse(xhttp.responseText).watchers_count);
          response = xhttp.responseText;
          text = xhttp.responseText;
          console.error("MAIN " + response);
          return response;

        } else {
          reject({
            status: xhttp.status,

            statusText: xhttp.statusText
          });
        }
      };

      xhttp.open("POST", url, true);
      xhttp.setRequestHeader("ngrok-skip-browser-warning", "1");
      xhttp.setRequestHeader('Content-Type', 'application/json');
      console.error("before va" + jsonDate);
      xhttp.send(JSON.stringify(jsonDate));

    });;

    console.error(text);
    console.error("after call");
    await context.sync();


    sheets.getItem("Sheet1").getCell(activeCell.rowIndex, activeCell.columnIndex+1).values  = [[ text]];
    await context.sync();
  });
}
      
async function runencrypt() {
  await Excel.run(async (context) => {
    var Load_Opts_Arr = ['rowCount', 'rowIndex', 'columnCount', 'columnIndex', 'values', 'isEntireColumn', 'isEntireRow']  

    let activeCell = context.workbook.getSelectedRange();
    activeCell.load(Load_Opts_Arr);
    await context.sync(); 
    console.log("The active cell is--- " + activeCell.columnIndex + activeCell.rowIndex);
    const sheets = context.workbook.worksheets;
    let cell = sheets.getItem("Sheet1").getCell(activeCell.rowIndex, activeCell.columnIndex);
    cell.load("address, values");
    await context.sync();
    console.error(cell.values);
    var jsonDate = activeCell.values;
    console.error(jsonDate);
    var text = " ";
    await new Promise(function (resolve, reject) {
      const url = "https://cb599b0d5db8.ngrok.app/encrypt";
      var response = "";
      let xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function () {
        if (xhttp.readyState !== 4) return;

        if (xhttp.status == 200) {
          resolve(JSON.parse(xhttp.responseText).watchers_count);
          response = xhttp.responseText;
          text = xhttp.responseText;
          console.error("MAIN " + response);
          return response;

        } else {
          reject({
            status: xhttp.status,

            statusText: xhttp.statusText
          });
        }
      };

      xhttp.open("POST", url, true);
      xhttp.setRequestHeader("ngrok-skip-browser-warning", "1");
      xhttp.setRequestHeader('Content-Type', 'application/json');
      console.error("before va" + jsonDate);
      xhttp.send(JSON.stringify(jsonDate));

    });;

    console.error(text);
    console.error("after call");
    await context.sync();


    sheets.getItem("Sheet1").getCell(activeCell.rowIndex+1, activeCell.columnIndex).values = [[text]];
    await context.sync();
  });
}         
      
async function runwsvirus() {
  await Excel.run(async (context) => {
    let activeCell = context.workbook.getActiveCell();
    activeCell.load("address, values,columnIndex,rowIndex");
    await context.sync();

    console.log("The active cell is " + activeCell.columnIndex + activeCell.rowIndex);
    const sheets = context.workbook.worksheets;
    let cell = sheets.getItem("Sheet1").getCell(activeCell.rowIndex,activeCell.columnIndex );
    cell.load("address, values");
    await context.sync();
    var jsonDate = cell.values[0][0];
    console.error(jsonDate);
    var text = " ";
    await new Promise(function (resolve, reject) {
      const url = "https://cb599b0d5db8.ngrok.app/virus";
      var response = "";
      let xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function () {
        if (xhttp.readyState !== 4) return;

        if (xhttp.status == 200) {
          resolve(JSON.parse(xhttp.responseText).watchers_count);
          response = xhttp.responseText;
          text = xhttp.responseText;
          console.error("MAIN " + response);
          return response;

        } else {
          reject({
            status: xhttp.status,

            statusText: xhttp.statusText
          });
        }
      };

      xhttp.open("POST", url, true);
      xhttp.setRequestHeader("ngrok-skip-browser-warning", "1");
      xhttp.setRequestHeader('Content-Type', 'application/json');
      console.error("before va" + jsonDate);
      xhttp.send(JSON.stringify(jsonDate));

    });;

    console.error(text);
    console.error("after call");
    await context.sync();


    sheets.getItem("Sheet1").getCell(activeCell.rowIndex, activeCell.columnIndex+1).values  = [[ text]];
    await context.sync();
  });
}            
async function runwsposthello() {
  await Excel.run(async (context) => {
    let activeCell = context.workbook.getActiveCell();
    activeCell.load("address, values,columnIndex,rowIndex");
    await context.sync();

    console.log("The active cell is " + activeCell.columnIndex + activeCell.rowIndex);
    const sheets = context.workbook.worksheets;
    let cell = sheets.getItem("Sheet1").getCell(activeCell.rowIndex,activeCell.columnIndex );
    cell.load("address, values");
    await context.sync();
    var jsonDate = cell.values[0][0];
    console.error(jsonDate);
    var text = " ";
    await new Promise(function (resolve, reject) {
      const url = "https://cb599b0d5db8.ngrok.app/hello";
      var response = "";
      let xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function () {
        if (xhttp.readyState !== 4) return;

        if (xhttp.status == 200) {
          resolve(JSON.parse(xhttp.responseText).watchers_count);
          response = xhttp.responseText;
          text = xhttp.responseText;
          console.error("MAIN " + response);
          return response;

        } else {
          reject({
            status: xhttp.status,

            statusText: xhttp.statusText
          });
        }
      };

      xhttp.open("POST", url, true);
      xhttp.setRequestHeader("ngrok-skip-browser-warning", "1");
      xhttp.setRequestHeader('Content-Type', 'application/json');
      console.error("before va" + jsonDate);
      xhttp.send(JSON.stringify(jsonDate));

    });;

    console.error(text);
    console.error("after call");
    await context.sync();


    sheets.getItem("Sheet1").getCell(activeCell.rowIndex, activeCell.columnIndex+1).values  = [[ text]];
    await context.sync();
  });
}
      

      

async function runwsposttime() {
  await Excel.run(async (context) => {
    let activeCell = context.workbook.getActiveCell();
    activeCell.load("address, values,columnIndex,rowIndex");
    await context.sync();

    console.log("The active cell is " + activeCell.columnIndex + activeCell.rowIndex );

  
    const sheets = context.workbook.worksheets;
    let cell = sheets.getItem("Sheet1").getCell(activeCell.columnIndex, activeCell.rowIndex);
    cell.load("address, values");

    await context.sync();
    var jsonDate = cell.values[0][0];
    console.error(jsonDate);
    var text = " ";
    await new Promise(function (resolve, reject) {
      const url = "https://cb599b0d5db8.ngrok.app/time";
      var response = "";
      let xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function () {
        if (xhttp.readyState !== 4) return;

        if (xhttp.status == 200) {
          resolve(JSON.parse(xhttp.responseText).watchers_count);
          response = xhttp.responseText;
          text = xhttp.responseText;
          console.error("MAIN " + response);
          return response;

        } else {
          reject({
            status: xhttp.status,

            statusText: xhttp.statusText
          });
        }
      };

      xhttp.open("POST", url, true);
      xhttp.setRequestHeader("ngrok-skip-browser-warning", "1");
      xhttp.setRequestHeader('Content-Type', 'application/json');
      console.error("before va" + jsonDate);
      xhttp.send(JSON.stringify(jsonDate));

    });;

    console.error(text);
    console.error("after call");
    await context.sync();


    sheets.getItem("Sheet1").getCell(activeCell.rowIndex, activeCell.columnIndex).values = [[ text]];
    await context.sync();
  });
}
   
       
      
        async function run() {
            await Excel.run(async (context) => {
                const range = context.workbook.getSelectedRange();
                range.format.fill.color = "yellow";
                range.load("address");

                await context.sync();

                const sheets = context.workbook.worksheets;
                sheets.getItem("Sheet1").getRange("A1").values = [["The selected address was " + range.address + "."]];
            });
        }

      async function runws() {
            await Excel.run(async (context) => {
                const range = context.workbook.getSelectedRange();
                range.format.fill.color = "yellow";
                range.load("address");

                await context.sync();

                const sheets = context.workbook.worksheets;
                sheets.getItem("Sheet1").getRange("A1").values = [["The selected address was " + range.address + "."]];
            });
        }
    
async function runws() {
  await Excel.run(async (context) => {

    const range = context.workbook.getSelectedRange();
    range.format.fill.color = "yellow";
    range.load("address");
    console.error("Before call");
    var text = " ";
    await new Promise(function (resolve, reject) {
      const url = "https://160f-34-125-91-46.ngrok-free.app/";
      var response = "";
      let xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function () {
        if (xhttp.readyState !== 4) return;

        if (xhttp.status == 200) {
          resolve(JSON.parse(xhttp.responseText).watchers_count);
          response = xhttp.responseText;
          text = xhttp.responseText;
          console.error("MAIN " + response);
          return response;

        } else {
          reject({
            status: xhttp.status,

            statusText: xhttp.statusText
          });
        }
      };

      xhttp.open("GET", url, true);
      xhttp.setRequestHeader("ngrok-skip-browser-warning", "1");

      xhttp.send();

    });;

    console.error(text);
    console.error("after call");
    await context.sync();

    const sheets = context.workbook.worksheets;
    sheets.getItem("Sheet1").getRange("A1").values = [["The selected address was " + text]];
    await context.sync();
  });
}


       

    </script>

     

</body>

</html>
